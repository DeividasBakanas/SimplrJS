<style type="text/css">.layout-component { display: none; }</style>
<script type="text/javascript">
	QUnit.config.reorder = false
	$(function() {

		// Setup the DEMO HTML for these tests
		var testLayouts =	'<script id="layout-test2" type="text/x-simplr-layout-component">' +
				                '<div id="test2">test2</div>' +
				            '<\/script>' +
				            '<script id="layout-test3" type="text/x-simplr-layout-component">' +
				                '<div id="test3">test3</div>' +
				            '<\/script>' +
				            '<script id="layout-nested" type="text/x-simplr-layout-component">' +
				                '<div id="nested"><span>nested</span></div>' +
				            '<\/script>' +
				            '<script id="layout-nested2" type="text/x-simplr-layout-component">' +
				                '<div id="nested2"><a href="http://www.google.com/#/test/test/">this is a link</a></div>' +
				            '<\/script>';
		$("#js-testHTML").append(testLayouts);

		module("Simplr.Layout");
		
		test("Components exist in page as script tags", function() {
			equal( $("script[type='text/x-simplr-layout-component']").size(), 4, "Components Expected");
		});
	
		test("Simplr.Layout.mAddComponent(key, component)", function() {
			equal(Simplr.Layout.mGetComponent("test1"), undefined, "Component doesnt exist in memory or dom");
			Simplr.Layout.mAddComponent("test1", '<div id="test1">test1</div>');
			equal(Simplr.Layout.mGetComponent("test1"), '<div id="test1">test1</div>', "Component 1 now exists");
		});
	
		test("Simplr.Layout.mGetComponent()", function() {
			equal(Simplr.Layout.mGetComponent("doesnntexist"), undefined, "undefined component");
			equal(Simplr.Layout.mGetComponent("test1"), '<div id="test1">test1</div>', "Component 1");
			equal(Simplr.Layout.mGetComponent("test2"), '<div id="test2">test2</div>', "Component 2");
			equal(Simplr.Layout.mGetComponent("test3"), '<div id="test3">test3</div>', "Component 3");
			equal(Simplr.Layout.mGetComponent("nested"), '<div id="nested"><span>nested</span></div>', "Nested Component");
			equal(Simplr.Layout.mGetComponent("nested2"), '<div id="nested2"><a href="http://www.google.com/#/test/test/">this is a link</a></div>', "Nested -> Nested Component");
		});
		
		test("Simplr.Layout.mAddGlobalToken()", function() {
			Simplr.Layout.mAddGlobalToken("GB1", "word1");
			Simplr.Layout.mAddGlobalToken("GB2", "word2");
			var gTokens = Simplr.Layout.mData().GlobalTokens;
			equal(gTokens["GB1"], "word1", "Global Token 1");
			equal(gTokens["GB2"], "word2", "Global Token 2");
		});
		
		test("Simplr.Layout.mAssembleLayout()", function() {
			// Add some simple layout components
			Simplr.Layout.mAddComponent("cp1", "$[token]");
			Simplr.Layout.mAddComponent("cp2", "--$[token1]--$[token2]");
			Simplr.Layout.mAddComponent("cp3", "++$[string1]++$[string2]++");
			// Assemble a Layout
			equal(Simplr.Layout.mAssembleLayout({
				component : "cp3",
				tokens : {
					string1 : "1",
					string2 : "2"
				}
			}), "++1++2++", "Simple Replacement");
			// Assemble a Layout
			equal(Simplr.Layout.mAssembleLayout({
				component : "cp3",
				tokens : [
					{ string1 : "1", string2 : "2" },
					{ string1 : "3", string2 : "4" },
					{ string1 : "5", string2 : "6" }
				]
			}), "++1++2++++3++4++++5++6++", "Simple replacement with repeats");
			// Assemble a Layout
			equal(Simplr.Layout.mAssembleLayout({
				component : "cp3",
				tokens : {
					string1 : "1",
					string2 : {
						component : "cp1",
						tokens : {
							token : "a"
						}
					}
				}
			}), "++1++a++", "Nest replacement");
			// Assemble a Layout
			equal(Simplr.Layout.mAssembleLayout({
				component : "cp3",
				tokens : {
					string1 : "1",
					string2 : {
						component : "cp1",
						tokens : [
							{ token : "a" },
							{ token : "b" },
							{ token : "c" }
						]
					}
				}
			}), "++1++abc++", "Nested replacement with repeats");
			// Assemble a Layout
			equal(Simplr.Layout.mAssembleLayout({
				component : "cp3",
				tokens : {
					string1 : {
						component : "cp2",
						tokens : {
							token1 : {
								component: "cp2",
								tokens : [
									{ token1 : "1", token2 : "2" },
									{ token1 : "3", token2 : "4" }
								]
							},
							token2 : "z"
						}
					},
					string2 : {
						component : "cp1",
						tokens : [
							{ token : "a" },
							{ token : "b" },
							{ token : "c" }
						]
					}
				}
			}), "++----1--2--3--4--z++abc++", "multiple nested with repeats");
		});

	});
</script>